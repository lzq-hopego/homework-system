import{d as e,u as t,h as l,a as s,i as a,b as o,j as i,t as n,k as r,F as c,l as u,n as d,m as v,p as f,q as h,s as p,v as x,x as m,g,y as k,c as w,w as y,S as b,z as C,A as $,o as j,B as I,C as A,D as _,E as W}from"./index.0d8e5f74.js";import{u as B}from"./page.07c695b4.js";import{_ as z}from"./UBasePage.27d71fc6.js";const T=e({__name:"CourseActionSheet",props:{showActionSheet:{type:Boolean,default:!1},courseItem:{default:void 0}},emits:["cancel"],setup(e,{emit:m}){const g=e,k=t(),w=l((()=>k.getConflictCourse(g.courseItem))),y=l((()=>b(w.value[0])));function b(e){const{week:t,start:l,duration:s}=e;return`星期${p[t-1]} 第${l}-${l+s-1}节`}function C(){m("cancel")}return(t,l)=>{var p,m,g;return s(),a("div",{onTouchmove:l[0]||(l[0]=f((()=>{}),["prevent"]))},[o("div",{class:v(["bg-base w-full min-h-10 z-100 fixed transition-all transition-duration-300 transition-ease-in-out",e.showActionSheet&&(null==(p=i(w))?void 0:p.length)?"bottom-0":"-bottom-full"]),transition:"all duration-300 ease-in-out"},[o("div",{class:"py-6 flex flex-col flex-gap6",flex:"~ col gap6"},[(null==(m=i(w))?void 0:m.length)?(s(),a("div",{key:0,class:"font-medium text-xl px-4"},n(i(y)),1)):r("v-if",!0),(s(!0),a(c,null,u(i(w),((e,t)=>(s(),a("div",{key:t,class:"px-4 flex flex-col flex-gap-2",flex:"~ col gap-2",onClick:t=>function(e){C(),x({url:`/pages/detail/detail?course=${e.title}`})}(e)},[o("div",{class:"flex mb-1 w-full gap-2 justify-start items-center relative"},[o("div",{class:"rounded-full h-5 w-1 inline-block",style:d(`background-color:${e.color}`)},null,4),o("div",{class:"font-medium text-lg"},n(e.title),1),o("div",{class:v(["text-xl top-0 right-4 bottom-0 z-20 absolute",t?"i-carbon-up-to-top":""]),onClick:f((t=>i(k).setCourseItemTop(e)),["stop"])},null,10,["onClick"])]),o("div",{class:"flex gap-1 justify-start items-center"},[o("div",{class:"i-carbon-location"}),h(" "+n(e.location),1)]),o("div",{class:"flex gap-1 justify-start items-center"},[o("div",{class:"i-carbon-user"}),h(" "+n(e.teacher),1)]),o("div",{class:"flex gap-1 justify-start items-center"},[o("div",{class:"i-carbon-alarm"}),h(" "+n(b(e)),1)])],8,["onClick"])))),128))]),o("div",{class:"uno-xqack9",text:"center lg dark:!white",b:"t-4 gray-200 dark:op-20","justify-center":"","items-center":"","hover-class":"bg-gray-200 bg-opacity-50","hover-stay-time":150,onClick:C}," 关闭 ")],2),o("div",{class:v(["bg-dark-100 bg-opacity-50 transition-all top-0 right-0 bottom-0 left-0 z-90 fixed",e.showActionSheet&&(null==(g=i(w))?void 0:g.length)?"opacity-100 visible":"opacity-0 invisible"]),onClick:C},null,2)],32)}}}),S=e({__name:"TimetableAction",props:{showCourseAction:{type:Boolean}},setup(e){const l=e,{parsedCourseList:d,originalWeekIndex:f,currentWeekIndex:h}=m(t()),{setCurrentWeekIndex:p}=t(),x=g("week0");return k((()=>+l.showCourseAction+h.value),(()=>{l.showCourseAction&&(x.value="week"+(h.value-1))})),(t,l)=>{const m=b;return s(),w(m,{class:v(["transition-height duration-300 overflow-scroll whitespace-nowrap",e.showCourseAction?"h-20":"h-0"]),"scroll-x":"","scroll-with-animation":"","scroll-into-view":x.value},{default:y((()=>[(s(!0),a(c,null,u(i(d),((e,t)=>(s(),a("div",{key:t,id:`week${t+1}`,class:"py-1 px-2 inline-block",onClick:e=>i(p)(t)},[o("div",{class:v(["rounded-lg py-1 px-2",i(f)===t?"uno-j4oh2x":i(h)===t?"uno-u995gr":""])},[o("div",{class:"text-xs text-center mb-1"},n(`第${t+1}周`),1),o("div",{class:"h-10 w-10 grid grid-flow-col grid-cols-5 grid-rows-5",grid:"~ flow-col cols-5 rows-5"},[(s(!0),a(c,null,u(e,((e,t)=>(s(),a(c,{key:t},[t<5?(s(!0),a(c,{key:0},u(e,((e,t)=>(s(),a("div",{key:t,class:v(["uno-5ysz5a",e?"bg-light-blue-500":"bg-gray-200"])},null,2)))),128)):r("v-if",!0)],64)))),128))])],2)],8,["id","onClick"])))),128))])),_:1},8,["class","scroll-into-view"])}}}),D=e({__name:"TimetableHeader",setup(e){const{isStart:l,currentMonth:r,originalWeekIndex:d,currentWeekIndex:f,originalWeekWeekIndex:h,currentWeekDayArray:x}=m(t());return(e,t)=>(s(),a("div",{class:"uno-usq0xe",grid:"~ cols-[0.7fr_repeat(7,1fr)] gap-1"},[o("div",{class:"flex font-medium text-sm items-center justify-center"},n(`${i(r)}月`),1),(s(!0),a(c,null,u(i(x),((e,t)=>{return s(),a("div",{key:t,class:v(["uno-opmu05",(r=t,l.value&&d.value&&f.value&&h.value&&d.value===f.value&&h.value===r?"uno-hf4vko":"")]),flex:"~ col","justify-evenly":"","items-center":"",b:"y-transparent x-none t-4 b-4"},[o("p",{class:"font-medium"},n(i(p)[t]),1),o("p",null,n(e),1)],2);var r})),128))]))}}),q=e({__name:"TimetableContent",props:{showCourseAction:{type:Boolean,default:!1}},emits:["courseItemClick"],setup(e,{emit:f}){const{getcourseTimeList:p}=t(),x=p(),{customBarHeight:k}=m(C()),{weekNum:w,weekCourseList:y,currentWeekIndex:b,originalWeekIndex:j}=m(t()),{hasConflictCourseByMap:I,setCurrentWeekIndex:A}=t(),_=l((()=>{const e=Array.from(y.value);if(e.length<=1)return e;for(let t=1;t<e.length;t++){const{start:l,week:s}=e[t],{start:a,week:o}=e[t-1];l===a&&s===o&&(e.splice(t,1),t--)}return e})),W=g(0),B=g(0),z=g(0),T=g(0);function q(e){W.value=e.touches[0].clientX,B.value=e.touches[0].clientY}function H(e){z.value=e.touches[0].clientX-W.value,T.value=e.touches[0].clientY-B.value}function L(){let e=b.value;if(!(0===z.value||Math.abs(T.value)>50)){if(z.value>50){if(0===e)return;e--}else if(z.value<-50){if(e===w.value-1)return;e++}A(e),W.value=0,B.value=0,z.value=0,T.value=0}}return(t,l)=>(s(),a("div",{class:"overflow-y-scroll relative bg-base",style:d({height:`calc(100vh - ${i(k)}px)`})},[o("div",{class:"w-full top-0 z-10 fixed bg-base",style:d({"padding-top":`${i(k)}px`})},[$(S,{"show-course-action":e.showCourseAction},null,8,["show-course-action"]),$(D)],4),o("div",{class:v(["uno-v3roi8",e.showCourseAction?"pt-31":"pt-11"]),grid:"~ flow-col rows-10 cols-[0.7fr_repeat(7,1fr)] gap-1",onTouchstart:q,onTouchmove:H,onTouchend:L},[(s(!0),a(c,null,u(i(x),((e,t)=>(s(),a("div",{key:t,class:"text-sm min-h-18 flex flex-col justify-evenly items-center",flex:"~ col","justify-evenly":"","items-center":""},[o("div",{class:"font-medium"},n(t+1),1),o("div",{class:"uno-k83xkl"},[h(n(e.s),1),o("br"),h(n(e.e),1)])])))),128)),(s(!0),a(c,null,u(i(_),((e,t)=>{return s(),a("div",{key:t,class:"uno-a9dffp",b:"white 2 !op-50",style:d([(l=e,{"grid-row":`${l.start} / ${l.start+l.duration}`,"grid-column":`${l.week+1} / ${l.week+1+1}`}),`background-color:${i(I)(e)[0].color}`]),onClick:t=>f("courseItemClick",e)},[o("div",{class:"h-full w-full text-center text-white text-xs flex flex-col justify-around items-center",text:"center white xs",flex:"~ col","justify-around":"","items-center":""},[o("div",{class:"font-medium break-all"},n(i(I)(e)[0].title),1),o("div",{class:"break-all"},[o("div",{class:"text-8px i-carbon-location-current"}),h(" "+n(i(I)(e)[0].location),1)]),i(I)(e).length>1?(s(),a("div",{key:0,class:"uno-72x21d"})):r("v-if",!0)])],12,["onClick"]);var l})),128))],34),o("div",{class:v(["uno-pltnqj",i(j)!==i(b)?"right-0":"-right-full"]),text:"white sm",p:"l-4 y-2 r-2",onClick:l[0]||(l[0]=e=>i(A)(i(j)))}," 返回本周 ",2)],4))}}),H=e({__name:"index",setup(e){const{customBarHeight:l,statusBarHeight:a}=C(),{setPageConfig:c}=B(),{currentWeekIndex:u,isStart:f}=m(t()),{setCourseList:p,setStartDay:k,getcookie:b}=t();j((()=>{c({showNavBar:!1})}));const S=g(!1);function D(){x({url:"/pages/detail/detail"})}const H=g(!1),L=g();function M(e){H.value=!0,L.value=e}function P(){H.value=!1}function N(){window.location.href="/"}return I((()=>{(async()=>{let e="https://zuoye-api.lizhanqi.cn:8081/api/kebiao?usertoken="+b();const t=await A.get(e),l=new Date(t.data["start-learn-time"]);l.setDate(l.getDate()+-7),k(l),p(t.data.data)})()})),(e,t)=>{const c=_(W("UBasePage"),z);return s(),w(c,null,{default:y((()=>[o("div",{class:"bg-primary text-white w-full top-0 z-200 fixed font-bold",style:d({height:`${i(l)}px`})},[o("div",{style:d({"padding-top":`${i(a)}px`,height:i(l)-i(a)+"px"})},[o("div",{class:"h-full text-center px-6 relative"},[o("div",{class:"h-full text-xl left-4 i-carbon-chevron-left absolute",onClick:N}),o("div",{class:"flex h-full mx-auto justify-center items-center inline-block text-lg",onClick:t[0]||(t[0]=e=>S.value=!S.value)},[h(n(`第${i(u)+1}周${i(f)?"":"(未开学)"}`)+" ",1),o("div",{class:v(["transition-transform duration-300 i-carbon-chevron-up",S.value?"rotate-180":"rotate-0"])},null,2),o("div",{class:"h-full text-xl right-4 i-carbon-add absolute",onClick:D})])])],4)],4),r(" timetable main content "),$(q,{"show-course-action":S.value,onCourseItemClick:M},null,8,["show-course-action"]),r(" course card "),$(T,{"show-action-sheet":H.value,"course-item":L.value,onCancel:P},null,8,["show-action-sheet","course-item"])])),_:1})}}});export{H as default};
